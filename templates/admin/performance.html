<script>htall.include('layout/layout.html')</script>
<div id="extend">
    <div class="container-fluid">
        
    <div class="row">
        <div class="col-md-12">
          <div class="card" style="height: 100%!important">
            <div class="card-body">
              <div class="row">
                <div class="col-md-8">
                  <p class="text-center">
                    <strong>Examiners</strong>
                  </p>
  
                  <div class="chart">
                    <!-- Sales Chart Canvas -->
                    <canvas id="salesChart" height="270"></canvas>
                  </div>
                  <!-- /.chart-responsive -->
                </div>
                <!-- /.col -->
                
                <div class="col-md-4" style="display: flex; align-items: center;">
                  <div class="col-12">
                    <div class="progress-group">
                      Passed
                      <span id="mocklabel" class="float-right"><b></b></span>
                      <div class="progress progress-sm">
                        <div id="passed" class="progress-bar bg-primary" style="width: 80%"></div>
                      </div>
                    </div>
  
                    <div class="progress-group">
                      Failed
                      <span id="suastlabel" class="float-right"><b></b></span>
                      <div class="progress progress-sm">
                        <div id="failed" class="progress-bar bg-danger" style="width: 75%"></div>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- /.col -->
              </div>
              <!-- /.row -->
            </div>
            <!-- ./card-body -->
            <div class="card-footer">
              <div class="row">
                <div class="col-sm-6">
                  <div class="description-block border-right">
                    <span class="description-percentage text-success">0%</span>
                    <h5 class="description-header"></h5>
                    <span class="description-text">PASSED</span>
                  </div>
                  <!-- /.description-block -->
                </div>
                <!-- /.col -->
                <div class="col-sm-6">
                  <div class="description-block">
                    <span class="description-percentage text-warning">0%</span>
                    <h5 class="description-header"></h5>
                    <span class="description-text">Failed</span>
                  </div>
                  <!-- /.description-block -->
                </div>
              </div>
              <!-- /.row -->
            </div>
            <!-- /.card-footer -->
          </div>
          <!-- /.card -->
        </div>
        <!-- /.col -->
      </div>
    </div>
</div>


<script src="bootstrap/chart.js/chart.min.js"></script>
<script>
    $(function () {
      'use strict'
      var dashboard = htall.getData({
        url: 'route/adminDashboard',
        type: 'post'
      }),
      mock = 0,
      label = [],
      data = [],
      passed = 0,
      failed = 0,
      totalcount = 0,
      gwa = parseFloat(dashboard.gwa),
      gwapercent = (1/gwa)*100,
      mock = (dashboard.mock_exam/100)*100,
      avg = ((gwapercent+mock)/200)*100
      console.log(dashboard)
      for(var i = 0; i < Object.keys(dashboard).length ;i++){
        var date = new Date(dashboard[i].register_date)
        var year = date.getFullYear(),
        gwa = parseFloat(dashboard[i].gwa),
        gwapercent = (1/gwa)*100,
        mock = (dashboard[i].mock_exam/100)*100,
        avg = ((gwapercent+mock)/200)*100
        avg > 70 ? passed++ : failed++
        if(label.length == 0){
          label.push(year)
          data.push(1)
        }else
          for(var j = 0; j < label.length ;j++){
            if(label[j] == year){
            }else{
              if(j+1 == label.length){
                label.push(year)
                data.push(1)
              }
            }
          }
          totalcount++
      }

      console.log("dashboard : "+label)
      $("#mocklabel").html("<b>"+passed+"/</b>"+totalcount)
      $("#suastlabel").html("<b>"+failed+"/</b>"+totalcount)
      $("#passed").css('width',(passed/totalcount)*100+"%")
      $("#failed").css('width',(failed/totalcount)*100+"%")

      
      var salesChartCanvas = $('#salesChart').get(0).getContext('2d')
        
      var salesChartData = {
        labels: label,
        datasets: [
          {
            label: 'Mock Exam',
            backgroundColor: 'rgba(60,141,188,0.9)',
            borderColor: 'rgba(60,141,188,0.8)',
            pointRadius: false,
            pointColor: '#3b8bba',
            pointStrokeColor: 'rgba(60,141,188,1)',
            pointHighlightFill: '#fff',
            pointHighlightStroke: 'rgba(60,141,188,1)',
            data: data
          }
        ]
      }

      var salesChartOptions = {
        maintainAspectRatio: false,
        responsive: true,
        legend: {
          display: false
        },
        scales: {
          xAxes: [{
            gridLines: {
              display: false
            }
          }],
          yAxes: [{
            gridLines: {
              display: false
            }
          }]
        }
      }

      var salesChart = new Chart(salesChartCanvas, {
        type: 'line',
        data: salesChartData,
        options: salesChartOptions
      })
    })

</script>